<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link rel="stylesheet" href="css/estilos.css">
  <title>Ver Pedidos</title>
 
</head>
<body>
  <nav class="menu">
    <a href="index2.html">Inicio</a>
    <a href="agregar.html">Agregar Pedido</a>
    <a href="pedidos.html">Agregar al Pedido</a>
    <a href="pagos.html">Registrar Pago</a>
    <a href="cierre.html">Hacer Cierre</a>
  </nav>
  <h2>Pedidos Realizados</h2>
  <table>
    <thead>
      <tr>
        <th>Cliente</th>
        <th>Productos</th>
        <th>Total</th>
        <th>Acción</th>
      </tr>
    </thead>
    <tbody id="listaPedidos"></tbody>
  </table>

  <script>
    // Obtener todos los pedidos guardados en localStorage
    const pedidos = JSON.parse(localStorage.getItem("pedidos")) || [];
    const tbody = document.getElementById("listaPedidos");

    // Agrupar pedidos por cliente
    const pedidosPorCliente = pedidos.reduce((acc, item) => {
      if (!acc[item.cliente]) acc[item.cliente] = [];
      acc[item.cliente].push(item);
      return acc;
    }, {});

    // Mostrar pedidos en la tabla
    if (Object.keys(pedidosPorCliente).length === 0) {
      tbody.innerHTML = '<tr><td colspan="4">No hay pedidos registrados.</td></tr>';
    } else {
      for (const cliente in pedidosPorCliente) {
        const items = pedidosPorCliente[cliente];
        let productosHTML = "<ul>";
        let total = 0;

        items.forEach(i => {
          i.productos.forEach(prod => {
            const subtotal = prod.cantidad * prod.precio;
            productosHTML += `<li>${prod.cantidad} x ${prod.nombre} = $${subtotal.toFixed(2)}</li>`;
          });
          total += i.subtotal;
        });

        productosHTML += "</ul>";

        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${cliente}</td>
          <td>${productosHTML}</td>
          <td>$${total.toFixed(2)}</td>
          <td><button onclick="editarPedido('${cliente}')">Agregar al Pedido</button></td>
        `;
        tbody.appendChild(tr);
      }
    }

    // Función para editar pedido
    function editarPedido(cliente) {
      const pedidosCliente = pedidosPorCliente[cliente];
      if (pedidosCliente.length > 0) {
        // Tomar el último pedido para editar
        localStorage.setItem("pedidoEditar", JSON.stringify(pedidosCliente[pedidosCliente.length - 1]));
        window.location.href = "agregar.html";
      }
    }
  </script>
</body>
</html>
